<!DOCTYPE html>
<html>
  <head>
    <title>Codeslice</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0,maximum-scale=1.0,user-scalable=no">
    <%= stylesheet_link_tag    'application', media: 'all', 'data-turbolinks-track' => true %>
    <%= javascript_include_tag 'application', 'data-turbolinks-track' => true %>
    <%= csrf_meta_tags %>

    <!-- accelerate page switch with turbolinks -->
    <script>
      <!-- marked -->
      function renderText(block) {
          var md = marked(block.innerHTML);
          block.innerHTML = md;
      }

      $(document).ready(function(){
        var blocks = document.querySelectorAll('.se_text');
        Array.prototype.forEach.call(blocks, renderText);
      });

      <!-- highlight -->
      function highlightText(block) {
        hljs.highlightBlock(block);
      }
      $(document).ready(function(){
        var blocks = document.querySelectorAll("pre code");
        Array.prototype.forEach.call(blocks, highlightText);
      });

      <!--google analytics-->
      var _gaq = _gaq || [];
      _gaq.push(["_setAccount", "<%= Settings.google_analytics_key %>"]);
      _gaq.push(["_setSiteSpeedSampleRate", 100]);
      _gaq.push(["_trackPageview"]);

      (function() {
        var ga = document.createElement("script");
        ga.async = true;
        ga.src = ("https:" == document.location.protocol ? "https://ssl" : "http://www") + ".google-analytics.com/ga.js";
        var s = document.getElementsByTagName("script")[0];
        s.parentNode.insertBefore(ga, s);
      })();

      $(document).on("page:change", function(){
        if window._gaq?
          _gaq.push(["_trackPageview"]);
        else if window.pageTracker?
          pageTracker._trackPageview();
      })
    </script>
  </head>
  <body data-controller-name="<%= controller_name %>">
    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <ul class="navbar-left nav nav-pills col-md-5">
            <li class="active"><%= link_to "Share", "#" %></li><!--
            --><li><%= link_to "Ask", "#" %></li><!--
            --><li><%= link_to "Award", "#" %></li>
          </ul>
          <div class="site-logo col-md-2">
            <%= link_to "CodeSlice", "/", class: "navbar-brand" %>
          </div>
          <div class="navbar-right">
            <form action="#" class="navbar-search" method="get">
              <input type="text" name="q" class="form-control"
              value="<%= params[:q] %>" placeholder="search"
              disabled >
            </form>
            <div class="navbar-account">
              <ul class="nav nav-pills">
                <% if current_user %>
                  <li class="dropdown">
                    <%= link_to user_path(current_user),
                      class: "dropdown-toggle",
                      data: {toggle: "dropdown"} do %>
                      <%= current_user.nickname %>
                      <span class="caret"></span>
                    <% end %>
                    <ul class="dropdown-menu">
                      <li><%= link_to "Home", "#" %></li><!--
                      --><li><%= link_to "Profile", "#" %></li><!--
                      --><li><%= link_to "Message", "#" %></li><!--
                      --><li class="divider"></li><!--
                      --><li><%= link_to "Log out", "/account/logout" %></li>
                    </ul>
                  </li>
                <% else %>
                  <li class="dropdown">
                    <%= link_to "#", class: "dropdown-toggle",
                      data: {toggle: "dropdown"} do %>
                      Account<span class="caret"></span>
                    <% end %>
                    <ul class="dropdown-menu">
                      <li><%= link_to "Log in", "/account/login" %></li><!--
                      --><li><%= link_to "Sign up", "/account/signup" %></li>
                    </ul>
                  </li>
                <% end %>
              </ul>
            </div>
          </div>
        </div>
      </div>
    </div>

    <header class="top-fixed">
      <% if flash[:notice] %>
        <p><%= flash[:notice] %></p><br>
      <% else %>
        <p>
          好记性不如烂笔头<br>
          The palest ink is better than the best memory.
        </p>
      <% end %>
    </header>

    <div class="clearfix container">
      <section>
        <%= yield %>
      </section>

      <aside>
        <%= render "sidebar" %>
      </aside>
    </div>
  </body>
</html>
